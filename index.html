<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Private 2-User Chat</title>
<style>
/* Basic layout */
body, html {margin:0;padding:0;height:100%;font-family:Arial,sans-serif;font-size:16px;}
#login, #chat{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%;}

/* LOGIN PAGE: premium green + rainbow gradient */
#login{
  background: linear-gradient(135deg,#00a000,#ff0000,#ffcc00,#0000ff,#ff00ff);
  background-size: 400% 400%;
  animation: rainbowBG 15s ease infinite;
  flex-direction: column;
}
@keyframes rainbowBG{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}
#login input, #login button{
  padding:12px;margin:8px;font-size:16px;width:80%;max-width:300px;border-radius:5px;border:1px solid #ccc;
}

/* CHAT PAGE */
#chat{
  display:none;
  height:100%;
  width:100%;
  flex-direction:column;
  background: url('https://i.ibb.co/F0G8Lkp/starscape.jpg') no-repeat center center fixed;
  background-size: cover;
}
#messages{
  flex:1;
  overflow-y:auto;
  width:95%;
  max-width:600px;
  margin:10px auto;
  padding:10px;
  background:rgba(240,240,240,0.8);
  border-radius:10px;
  display:flex;
  flex-direction:column;
}
.message{
  display:flex;
  margin:5px;
  max-width:80%;
  align-items:flex-end;
}
.bubble{
  padding:10px;
  border-radius:20px;
  word-wrap:break-word;
  font-size:16px;
  position:relative;
  line-height:1.4;
}
.sender{justify-content:flex-end;align-self:flex-end;}
.sender .bubble{background:#dcf8c6;margin-left:5px;border-top-right-radius:0;}
.receiver{justify-content:flex-start;align-self:flex-start;}
.receiver .bubble{background:#ffb6c1;margin-right:5px;border-top-left-radius:0;}
.avatar-circle{
  width:35px;height:35px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;margin:0 5px;flex-shrink:0;
  background: #ccc;
}
.avatar-sender{color: green;}
.avatar-receiver{color: pink;}
#chat-controls{display:flex;justify-content:center;width:95%;max-width:600px;margin-bottom:10px;}
#msg{flex:1;padding:10px;font-size:16px;border-radius:20px;border:1px solid #ccc;}
#recordBtn, #sendBtn{padding:10px;font-size:16px;margin-left:5px;border-radius:20px;}
audio{display:block;margin-top:5px;max-width:100%;border-radius:10px;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login">
<h2>Private Login</h2>
<input id="user" placeholder="User ID">
<input id="pass" placeholder="Password" type="password">
<input id="name" placeholder="Your Name (Optional)">
<button onclick="login()">Login</button>
</div>

<!-- CHAT -->
<div id="chat">
<div id="messages"></div>
<div id="chat-controls">
<input type="text" id="msg" placeholder="Type a message" onkeydown="if(event.key==='Enter'){sendMessage()}">
<button id="sendBtn" onclick="sendMessage()">Send</button>
<button id="recordBtn">ðŸŽ¤ Record</button>
</div>
</div>

<!-- Knock Knock notification sound -->
<audio id="notifSound" src="https://www.soundjay.com/button/sounds/button-10.mp3" preload="auto"></audio>

<!-- FIREBASE SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ===== FIREBASE CONFIG (UNCHANGED) =====
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";

const firebaseConfig = {
  apiKey: "AIzaSyB44cXr29RuwC95yI87FGn1lZnPVKMozRU",
  authDomain: "pvtapp-4d511.firebaseapp.com",
  projectId: "pvtapp-4d511",
  storageBucket: "pvtapp-4d511.firebasestorage.app",
  messagingSenderId: "487734288517",
  appId: "1:487734288517:web:a54583ab19b2dcda5509ec",
  measurementId: "G-RBF3N8ELYE"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
// ======================================================

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===== LOGIN =====
const USER="Excel@123";
const PASS="Microsoft@123";
let currentUser="", currentName="";
let mediaRecorder, audioChunks=[];
let lastActivity = Date.now();

function login(){
  const u=document.getElementById("user").value;
  const p=document.getElementById("pass").value;
  const n=document.getElementById("name").value || "Me";
  if(u===USER && p===PASS){
    currentUser=u;
    currentName=n;
    document.getElementById("login").style.display="none";
    document.getElementById("chat").style.display="flex";
    listenMessages();
    requestNotificationPermission();
    trackInactivity();
  } else {
    alert("Access Denied: wrong User ID or Password");
  }
}

// ===== INACTIVITY LOGOUT 24 HRS =====
function trackInactivity(){
  setInterval(()=>{
    if(Date.now() - lastActivity > 24*60*60*1000){
      alert("Logged out due to inactivity");
      location.reload();
    }
  },60000);
}
document.addEventListener("keydown",()=>{lastActivity=Date.now();});
document.addEventListener("mousemove",()=>{lastActivity=Date.now();});

// ===== ADD MESSAGE WITH INITIAL LETTERS =====
function addMessage(name, content, type, isAudio=false){
  const messages=document.getElementById("messages");
  const div=document.createElement("div");
  div.className="message "+type;

  const avatarCircle=document.createElement("div");
  avatarCircle.className="avatar-circle "+(type==="sender"?"avatar-sender":"avatar-receiver");
  avatarCircle.textContent=name.charAt(0).toUpperCase();

  const bubble=document.createElement("div");
  bubble.className="bubble";
  if(isAudio){
    const audio=document.createElement("audio");
    audio.src=content;
    audio.controls=true;
    bubble.appendChild(audio);
  } else {
    bubble.innerHTML=`<div class="name">${name}</div>${content}`;
  }

  if(type==="sender"){
    div.appendChild(bubble);
    div.appendChild(avatarCircle);
  } else {
    div.appendChild(avatarCircle);
    div.appendChild(bubble);
  }

  messages.appendChild(div);
  messages.scrollTop=messages.scrollHeight;

  if(type==="receiver") document.getElementById("notifSound").play();

  // Browser notifications
  if(type==="receiver" && Notification.permission==="granted"){
    new Notification(`New message from ${name}`,{body: content});
  }
}

// ===== SEND TEXT =====
function sendMessage(){
  const msg=document.getElementById("msg").value.trim();
  if(msg==="") return;
  db.ref("messages").push({user:currentUser,name:currentName,type:"text",content:msg,timestamp:Date.now()});
  document.getElementById("msg").value="";
  lastActivity = Date.now();
}

// ===== VOICE RECORDING =====
const recordBtn=document.getElementById("recordBtn");
recordBtn.onclick=async ()=>{
  if(recordBtn.textContent==="ðŸŽ¤ Record"){
    const stream=await navigator.mediaDevices.getUserMedia({audio:true});
    mediaRecorder=new MediaRecorder(stream);
    audioChunks=[];
    mediaRecorder.ondataavailable=e=>audioChunks.push(e.data);
    mediaRecorder.onstop=()=>{
      const blob=new Blob(audioChunks,{type:"audio/webm"});
      const reader=new FileReader();
      reader.onload=()=>{
        db.ref("messages").push({user:currentUser,name:currentName,type:"audio",content:reader.result,timestamp:Date.now()});
      };
      reader.readAsDataURL(blob);
    };
    mediaRecorder.start();
    recordBtn.textContent="â¹ Stop";
  } else {
    mediaRecorder.stop();
    recordBtn.textContent="ðŸŽ¤ Record";
  }
}

// ===== REAL-TIME LISTENER =====
function listenMessages(){
  db.ref("messages").on("child_added", snapshot=>{
    const msg=snapshot.val();
    const type=(msg.user===currentUser)?"sender":"receiver";
    addMessage(msg.name,msg.content,type,msg.type==="audio");
  });
}

// ===== REQUEST BROWSER NOTIFICATION =====
function requestNotificationPermission(){
  if("Notification" in window){
    Notification.requestPermission();
  }
}
</script>
</body>
</html>
